<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S T A R B L O O D</title>
    <style>
        :root {
            --blood-dark: #8a0000;
            --blood-glow: #b30000;
            --neon-glow: #ffd700;
            --glass-bg: rgba(20, 0, 0, 0.35);
            --card-w: 85px;
            --card-h: 120px;
        }

        body {
            margin: 0;
            background: #000;
            color: white;
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        #video-container {
            position: fixed;
            inset: 0;
            z-index: -10;
        }

        .bg-vid {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.35;
        }

        /* Circular glowing placeholder above title */
        #glow-video-placeholder {
            position: relative;
            width: 180px;
            height: 180px;
            margin: 30px auto 10px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 
                0 0 40px var(--blood-glow),
                0 0 80px rgba(179,0,0,0.7),
                inset 0 0 30px rgba(139,0,0,0.8);
            animation: pulse-glow 6s infinite ease-in-out;
            z-index: 90;
        }

        #glow-video-placeholder video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(1.1) contrast(1.15) saturate(1.4);
        }

        #glow-video-placeholder::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: radial-gradient(circle at 50% 50%, transparent 40%, rgba(179,0,0,0.35) 100%);
            pointer-events: none;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 40px var(--blood-glow), 0 0 80px rgba(179,0,0,0.7); }
            50% { box-shadow: 0 0 60px var(--blood-glow), 0 0 120px rgba(179,0,0,1); }
        }

        /* Landing page with intro video */
        #landing {
            position: fixed;
            inset: 0;
            z-index: 200;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1.8s ease-out;
        }

        .intro-vid {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 1;
            transition: opacity 1.8s ease-out;
        }

        .landing-content {
            position: relative;
            z-index: 10;
            text-align: center;
            padding: 30px;
            background: rgba(0,0,0,0.5);
            border-radius: 16px;
            backdrop-filter: blur(8px);
            border: 2px solid var(--blood-dark);
            box-shadow: 0 0 40px var(--blood-glow);
        }

        #username-input {
            font-size: 1.6rem;
            padding: 14px 28px;
            border: 2px solid var(--blood-dark);
            border-radius: 10px;
            background: var(--glass-bg);
            color: white;
            text-align: center;
            box-shadow: inset 0 0 12px var(--blood-glow), 0 0 25px var(--blood-glow), 0 0 45px rgba(139,0,0,0.6);
            backdrop-filter: blur(6px);
            margin-bottom: 20px;
            width: 300px;
        }

        #start-btn {
            padding: 14px 50px;
            background: transparent;
            border: 2px solid var(--blood-glow);
            color: var(--blood-glow);
            font-size: 1.3rem;
            cursor: pointer;
            box-shadow: 0 0 30px var(--blood-glow);
            border-radius: 10px;
            backdrop-filter: blur(4px);
        }

        #start-btn:hover {
            background: rgba(139,0,0,0.3);
        }

        #fade-overlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(to bottom, transparent, rgba(139,0,0,0.7), #000);
            opacity: 0;
            pointer-events: none;
            z-index: 205;
            transition: opacity 1.5s ease-out;
        }

        /* Game elements start hidden */
        #title, #timer, #game-board, .deck-stack {
            opacity: 0;
            transition: opacity 1.2s ease-in 0.6s;
        }

        /* Dripping Header */
        .header {
            margin-top: 5px;
            display: flex;
            gap: 6px;
            z-index: 100;
        }

        .letter {
            font-size: 3.2rem;
            font-weight: 900;
            color: var(--blood-glow);
            text-shadow: 0 0 10px var(--blood-glow), 2px 2px 4px #000;
            display: inline-block;
            animation: bleed 4s infinite ease-in-out;
        }

        @keyframes bleed {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(1.12) translateY(5px); }
        }

        /* Game Board */
        #game-board {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 14px;
            width: 90%;
            max-width: 720px;
            margin-top: 20px;
            perspective: 1400px;
        }

        .slot {
            width: var(--card-w);
            height: var(--card-h);
            position: relative;
            border: 1px solid var(--blood-dark);
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(139, 0, 0, 0.4);
            backdrop-filter: blur(2px);
        }

        /* Cards */
        .card {
            width: 100%;
            height: 100%;
            position: absolute;
            transform-style: preserve-3d;
            transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1), top 0.9s cubic-bezier(0.5, 0, 0.5, 1), left 0.9s cubic-bezier(0.5, 0, 0.5, 1), opacity 0.6s;
            cursor: pointer;
            z-index: 10;
        }

        .card.flipped { transform: rotateY(180deg); }

        .card.returning {
            z-index: 1000;
            pointer-events: none;
            transition: all 1.1s cubic-bezier(0.6, -0.28, 0.735, 0.045);
        }

        .face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 10px;
            border: 2px solid var(--blood-dark);
            background-size: cover;
            background-position: center;
            box-shadow: inset 0 0 15px var(--blood-glow), 0 0 20px var(--blood-glow), 0 0 35px rgba(139,0,0,0.7);
            backdrop-filter: blur(3px);
        }

        .front { transform: rotateY(180deg); }

        .back {
            background-image: url('https://j3oblrqjmsss4ayx.public.blob.vercel-storage.com/Star%20Blood%20Card%20Deck%20Face%20Value/1768948913173.jpg');
        }

        .matched-glow {
            box-shadow: inset 0 0 25px var(--blood-glow), 0 0 40px var(--blood-glow), 0 0 60px rgba(139,0,0,0.9) !important;
            transition: box-shadow 0.5s;
        }

        /* Deck Stack */
        .deck-stack {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 90px;
            height: 125px;
            cursor: pointer;
            z-index: 200;
            border-radius: 12px;
            border: 2px solid var(--blood-dark);
            box-shadow: 0 0 25px var(--blood-glow), inset 0 0 15px var(--blood-glow);
            backdrop-filter: blur(4px);
        }

        .deck-art {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 10px;
            background-size: cover;
            background-image: url('https://j3oblrqjmsss4ayx.public.blob.vercel-storage.com/Star%20Blood%20Card%20Deck%20Face%20Value/1768948913173.jpg');
        }

        .deck-label {
            position: absolute;
            bottom: -24px;
            width: 100%;
            text-align: center;
            font-size: 11px;
            color: var(--blood-glow);
            text-shadow: 0 0 8px var(--blood-glow);
        }

        /* Timer */
        #timer {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 1.5rem;
            color: var(--blood-glow);
            text-shadow: 0 0 10px var(--blood-glow);
            z-index: 100;
        }

        /* End Overlay */
        #end-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.92);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 300;
        }

        #congrats-message {
            font-size: 3rem;
            color: var(--blood-glow);
            text-shadow: 0 0 20px var(--blood-glow);
            padding: 20px 40px;
            border: 3px solid var(--blood-dark);
            border-radius: 12px;
            box-shadow: 0 0 40px var(--blood-glow), inset 0 0 25px var(--blood-glow);
            backdrop-filter: blur(8px);
            animation: bounceBlood 2s infinite;
        }

        @keyframes bounceBlood {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-12px); }
        }

        /* Leaderboard */
        #leaderboard {
            margin-top: 40px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 25px;
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 3px solid var(--blood-dark);
            border-radius: 12px;
            box-shadow: 0 0 35px var(--blood-glow), inset 0 0 20px var(--blood-glow);
            max-width: 700px;
        }

        .lb-header .lb-cell {
            font-weight: bold;
            color: var(--neon-glow);
            text-shadow: 0 0 8px var(--neon-glow);
        }

        .lb-cell {
            padding: 8px;
            text-align: center;
            border: 1px solid rgba(139, 0, 0, 0.4);
            border-radius: 6px;
        }

        /* Blood Rain */
        .rain-drop {
            position: absolute;
            width: 4px;
            height: 25px;
            background: linear-gradient(to bottom, var(--blood-glow), var(--blood-dark));
            opacity: 0.9;
            border-radius: 50% 50% 0 0;
            box-shadow: 0 0 12px var(--blood-glow);
            animation: fall linear infinite;
        }

        @keyframes fall {
            0% { transform: translateY(-120%); }
            100% { transform: translateY(120vh); }
        }

        /* Surprise Entity Push */
        #push-overlay {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 250;
            opacity: 0;
            transition: opacity 1s ease;
        }

        .push-active #video-container {
            filter: url(#push-distort-strong);
            transition: filter 0.4s ease-in;
        }

        #entity-flash {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 260;
            opacity: 0;
            transition: opacity 0.4s ease-in-out;
            background: radial-gradient(circle at 50% 50%, rgba(255,0,0,0.4) 0%, transparent 70%);
            mix-blend-mode: screen;
        }

        #entity-flash > div {
            position: absolute;
            top: 50%; left: 50%;
            width: 320px; height: 420px;
            transform: translate(-50%, -50%) scale(0.85);
            background: radial-gradient(ellipse at 50% 40%, #fff 0%, #000 35%, transparent 65%);
            filter: invert(1) hue-rotate(170deg) brightness(1.3);
            opacity: 0.75;
            border-radius: 50%;
            box-shadow: 0 0 100px #b30000;
        }
    </style>
</head>
<body>

    <div id="video-container">
        <video autoplay muted loop playsinline class="bg-vid">
            <source src="https://j3oblrqjmsss4ayx.public.blob.vercel-storage.com/2026-01-20-125904299.mp4" type="video/mp4">
        </video>
    </div>

    <!-- Circular glowing placeholder -->
    <div id="glow-video-placeholder">
        <video autoplay muted loop playsinline>
            <source src="https://j3oblrqjmsss4ayx.public.blob.vercel-storage.com/2026-01-20-125904299.mp4" type="video/mp4">
        </video>
    </div>

    <!-- Landing with intro video -->
    <div id="landing">
        <video id="intro-video" autoplay muted playsinline class="intro-vid">
            <source src="https://j3oblrqjmsss4ayx.public.blob.vercel-storage.com/Videoleap_2026_01_20_18_07_56_976.mp4" type="video/mp4">
        </video>

        <div class="landing-content">
            <input id="username-input" type="text" placeholder="Enter Username" maxlength="20" autocomplete="off">
            <button id="start-btn">Enter the Void</button>
        </div>
    </div>

    <!-- Fade transition overlay -->
    <div id="fade-overlay"></div>

    <!-- Entity flash for surprise -->
    <div id="entity-flash">
        <div></div>
    </div>

    <div class="header" id="title"></div>

    <div id="timer">00:00</div>

    <div id="game-board"></div>

    <div class="deck-stack" id="deck">
        <div class="deck-art" style="transform: translate(-5px, -5px); opacity: 0.6;"></div>
        <div class="deck-art"></div>
        <div class="deck-label">TAP TO SHUFFLE</div>
    </div>

    <div id="end-overlay">
        <div id="congrats-message">Starblood Awakens! Victory in the Cosmos!</div>
        <div id="leaderboard"></div>
    </div>

    <!-- SVG Filters -->
    <svg width="0" height="0" style="position:absolute;">
        <defs>
            <filter id="push-distort-strong" x="-50%" y="-50%" width="200%" height="200%">
                <feTurbulence type="fractalNoise" baseFrequency="0.005 0.01" numOctaves="5" seed="42" result="noise"/>
                <feDisplacementMap in="SourceGraphic" in2="noise" scale="0" xChannelSelector="R" yChannelSelector="G"/>
                <feComponentTransfer>
                    <feFuncR type="linear" slope="1.5"/>
                    <feFuncG type="linear" slope="1.5"/>
                    <feFuncB type="linear" slope="1.5"/>
                </feComponentTransfer>
            </filter>
        </defs>
    </svg>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // REPLACE WITH YOUR FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Title animation
        const titleEl = document.getElementById('title');
        "STARBLOOD".split('').forEach((char, i) => {
            const span = document.createElement('span');
            span.className = 'letter';
            span.textContent = char;
            span.style.animationDelay = `${i * 0.08}s`;
            titleEl.appendChild(span);
        });

        // Game variables
        let username = '';
        let startTime = 0;
        let timerInterval;
        let matchedPairs = 0;
        const totalPairs = 12;

        const basePath = "https://j3oblrqjmsss4ayx.public.blob.vercel-storage.com/Star%20Blood%20Card%20Deck%20Face%20Value/";
        const cardBack = basePath + "1768948913173.jpg";

        const faceFiles = [
            "1000035396.jpg", "1000035397.jpg", "1000035398.jpg", "1000035399.jpg",
            "1000035400.jpg", "1000035401.jpg", "1000035405.jpg", "1000035406.jpg",
            "1000035407.jpg", "1000035409.jpg", "1000035411.jpg", "1000035415.jpg"
        ];

        const assets = faceFiles.map(f => basePath + f);

        let activeFlipped = [];
        let locked = false;
        const board = document.getElementById('game-board');
        const deckEl = document.getElementById('deck');
        const landing = document.getElementById('landing');
        const endOverlay = document.getElementById('end-overlay');
        const leaderboardEl = document.getElementById('leaderboard');
        const timerEl = document.getElementById('timer');

        // Landing logic + fade transition
        const usernameInput = document.getElementById('username-input');
        const startBtn = document.getElementById('start-btn');
        const introVideo = document.getElementById('intro-video');
        const fadeOverlay = document.getElementById('fade-overlay');

        function startGame() {
            username = usernameInput.value.trim();
            if (username.length < 1) {
                usernameInput.style.boxShadow = '0 0 25px #ff0000';
                setTimeout(() => {
                    usernameInput.style.boxShadow = 'inset 0 0 12px var(--blood-glow), 0 0 20px var(--blood-glow), 0 0 40px rgba(139,0,0,0.6)';
                }, 600);
                return;
            }

            fadeOverlay.style.opacity = '1';
            introVideo.style.opacity = '0';
            landing.style.opacity = '0';

            setTimeout(() => {
                landing.style.display = 'none';
                fadeOverlay.style.opacity = '0';

                document.getElementById('title').style.opacity = '1';
                document.getElementById('timer').style.opacity = '1';
                document.getElementById('game-board').style.opacity = '1';
                document.querySelector('.deck-stack').style.opacity = '1';

                deckEl.onclick = initGame;
            }, 1800);
        }

        startBtn.addEventListener('click', startGame);

        usernameInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                startGame();
            }
        });

        usernameInput.focus();

        function initGame() {
            if (locked) return;
            locked = true;

            board.innerHTML = '';
            document.querySelectorAll('.card').forEach(c => c.remove());
            activeFlipped = [];
            matchedPairs = 0;

            let gameCards = [...assets, ...assets].sort(() => Math.random() - 0.5);

            gameCards.forEach((frontUrl, i) => {
                const slot = document.createElement('div');
                slot.className = 'slot';
                board.appendChild(slot);

                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.value = frontUrl;

                card.innerHTML = `
                    <div class="face front" style="background-image: url('${frontUrl}');"></div>
                    <div class="face back"></div>
                `;

                const deckRect = deckEl.getBoundingClientRect();
                card.style.top = deckRect.top + 'px';
                card.style.left = deckRect.left + 'px';
                document.body.appendChild(card);

                setTimeout(() => {
                    const slotRect = slot.getBoundingClientRect();
                    card.style.top = slotRect.top + 'px';
                    card.style.left = slotRect.left + 'px';
                }, 80 * i);

                card.addEventListener('click', () => flipCard(card));
            });

            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
            updateTimer();

            setTimeout(() => { locked = false; }, 80 * 24 + 400);
        }

        function flipCard(card) {
            if (locked || card.classList.contains('flipped') || activeFlipped.includes(card)) return;

            card.classList.add('flipped');
            activeFlipped.push(card);

            if (activeFlipped.length === 2) checkMatch();
        }

        function checkMatch() {
            locked = true;
            const [cardA, cardB] = activeFlipped;

            if (cardA.dataset.value === cardB.dataset.value) {
                matchedPairs++;
                setTimeout(() => {
                    cardA.classList.add('matched-glow');
                    cardB.classList.add('matched-glow');

                    setTimeout(() => {
                        const deckRect = deckEl.getBoundingClientRect();
                        [cardA, cardB].forEach(c => {
                            c.classList.add('returning');
                            c.style.top = deckRect.top + 'px';
                            c.style.left = deckRect.left + 'px';
                            c.style.transform = 'scale(0.08) rotateY(0deg)';
                            c.style.opacity = '0';
                            setTimeout(() => c.remove(), 1200);
                        });
                        activeFlipped = [];
                        locked = false;

                        if (matchedPairs === totalPairs) endGame();
                    }, 600);
                }, 400);
            } else {
                setTimeout(() => {
                    cardA.classList.remove('flipped');
                    cardB.classList.remove('flipped');
                    activeFlipped = [];
                    locked = false;
                }, 1100);
            }
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const mins = String(Math.floor(elapsed / 60)).padStart(2, '0');
            const secs = String(elapsed % 60).padStart(2, '0');
            timerEl.textContent = `${mins}:${secs}`;
        }

        async function endGame() {
            clearInterval(timerInterval);
            const time = Math.floor((Date.now() - startTime) / 1000);
            const date = new Date().toLocaleDateString();

            await db.collection('scores').add({
                username,
                time,
                date,
                timestamp: firebase.firestore.Timestamp.now()
            });

            if (localStorage.getItem('starblood_entity_seen') === 'true') {
                endOverlay.style.display = 'flex';
                createBloodRain();
                await loadLeaderboard();
                return;
            }

            localStorage.setItem('starblood_entity_seen', 'true');

            const surpriseDelay = Math.random() * 3000 + 2000;

            setTimeout(() => {
                const overlay = document.createElement('div');
                overlay.id = 'push-overlay';
                overlay.style.opacity = '1';
                document.body.appendChild(overlay);

                document.body.classList.add('push-active');

                const entityFlash = document.getElementById('entity-flash');
                entityFlash.style.opacity = '1';

                const displace = document.querySelector('#push-distort-strong feDisplacementMap');
                displace.setAttribute('scale', '180');

                setTimeout(() => {
                    entityFlash.style.opacity = '0.95';
                    setTimeout(() => entityFlash.style.opacity = '0', 350);
                }, 250);

                setTimeout(() => {
                    let scale = 180;
                    const settleInterval = setInterval(() => {
                        scale -= 18;
                        displace.setAttribute('scale', Math.max(0, scale));
                        if (scale <= 0) {
                            clearInterval(settleInterval);
                            document.body.classList.remove('push-active');
                            overlay.style.opacity = '0';
                            setTimeout(() => {
                                overlay.remove();
                                endOverlay.style.display = 'flex';
                                createBloodRain();
                                loadLeaderboard();
                            }, 1200);
                        }
                    }, 70);
                }, 900);
            }, surpriseDelay);
        }

        async function loadLeaderboard() {
            const q = query(collection(db, 'scores'), orderBy('time', 'asc'), limit(10));
            const snapshot = await getDocs(q);
            let entries = [];
            snapshot.forEach(doc => entries.push(doc.data()));

            leaderboardEl.innerHTML = `
                <div class="lb-cell lb-header">Rank</div>
                <div class="lb-cell lb-header">Username</div>
                <div class="lb-cell lb-header">Time (s)</div>
                <div class="lb-cell lb-header">Date</div>
            `;

            entries.forEach((entry, i) => {
                leaderboardEl.innerHTML += `
                    <div class="lb-cell">${i + 1}</div>
                    <div class="lb-cell">${entry.username}</div>
                    <div class="lb-cell">${entry.time}</div>
                    <div class="lb-cell">${entry.date}</div>
                `;
            });
        }

        function createBloodRain() {
            for (let i = 0; i < 100; i++) {
                const drop = document.createElement('div');
                drop.className = 'rain-drop';
                drop.style.left = `${Math.random() * 100}vw`;
                drop.style.animationDuration = `${Math.random() * 2 + 1}s`;
                drop.style.animationDelay = `${Math.random() * 2}s`;
                document.body.appendChild(drop);
                setTimeout(() => drop.remove(), 8000);
            }
        }
    </script>
</body>
</html>
