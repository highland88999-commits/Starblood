<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>S T A R B L O O D</title>
    <style>
        :root {
            --blood-dark: #8a0000;
            --blood-glow: #ff3333;
            --card-w: clamp(70px, 18vw, 95px);
            --card-h: calc(var(--card-w) * 1.42);
            --gap: clamp(8px, 2vw, 14px);
        }

        * { margin:0; padding:0; box-sizing:border-box; }

        body {
            background:#000; color:white;
            font-family:'Courier New', monospace;
            height:100vh; width:100vw;
            overflow:hidden; touch-action:none;
            -webkit-user-select:none; user-select:none;
        }

        .blood-header {
            position:fixed; top:16px; left:0; right:0; z-index:1000;
            color:var(--blood-glow); letter-spacing:10px;
            font-size:clamp(1.6rem, 7vw, 2.8rem);
            text-shadow:0 0 16px var(--blood-dark);
            pointer-events:none; opacity:0.92; text-align:center;
        }

        #video-container {
            position:fixed; inset:0; z-index:-10; pointer-events:none;
        }
        .bg-vid-main {
            width:100%; height:100%; object-fit:cover; opacity:0.38;
        }

        #game-board {
            position:relative; z-index:500;
            display:grid; grid-template-columns:repeat(4,1fr);
            gap:var(--gap); padding:90px 20px 80px;
            opacity:0; transition:opacity 1.1s ease;
            height:100%; align-content:center; justify-content:center;
        }

        @media (orientation: landscape) {
            #game-board { grid-template-columns:repeat(5,1fr); padding-top:70px; }
        }

        .card {
            width:var(--card-w); height:var(--card-h);
            position:relative; transform-style:preserve-3d;
            transition:transform 0.65s cubic-bezier(0.23,1,0.32,1);
            cursor:pointer; touch-action:manipulation;
            -webkit-tap-highlight-color:transparent;
        }

        .card.flipped { transform:rotateY(180deg); }

        .face {
            position:absolute; inset:0;
            backface-visibility:hidden; -webkit-backface-visibility:hidden;
            border-radius:9px; border:1px solid var(--blood-dark);
            overflow:hidden; background:#000;
        }

        .front {
            transform:rotateY(180deg);
            background-size:cover; background-position:center;
        }

        .back-video {
            width:100%; height:100%; object-fit:cover; opacity:0.82;
        }

        #landing {
            position:fixed; inset:0; z-index:2000; background:#000;
            display:flex; flex-direction:column; align-items:center; justify-content:center;
            transition:opacity 0.9s;
        }

        .landing-vid {
            position:absolute; inset:0; width:100%; height:100%; object-fit:cover; opacity:0.72; z-index:-1;
        }

        .btn-void {
            padding:18px 50px; border:2px solid var(--blood-glow);
            background:rgba(0,0,0,0.75); color:var(--blood-glow);
            font-size:1.4rem; letter-spacing:7px; cursor:pointer;
            transition:all 0.3s;
        }
        .btn-void:active { transform:scale(0.96); }

        #deck-frame {
            position:fixed; bottom:18px; right:18px; z-index:400;
            width:64px; height:90px;
            background:rgba(40,0,0,0.35); backdrop-filter:blur(10px);
            border:1px solid var(--blood-glow); border-radius:10px;
            overflow:hidden; transition:all 0.7s ease;
        }
        #deck-frame.minimized { width:48px; height:48px; border-radius:50%; }

        #match-counter {
            position:absolute; bottom:4px; left:0; right:0;
            text-align:center; font-size:9px; color:var(--blood-glow);
            text-shadow:0 0 6px #000;
        }
    </style>
</head>
<body>

<div class="blood-header">STARBLOOD</div>

<div id="video-container">
    <video autoplay muted loop playsinline class="bg-vid-main">
        <source src="https://j3oblrqjmsss4ayx.public.blob.vercel-storage.com/2026-01-20-125904299.mp4" type="video/mp4">
    </video>
</div>

<div id="landing">
    <video autoplay muted loop playsinline class="landing-vid">
        <source src="./bg/Videoleap_2026_01_20_18_07_56_976.mp4" type="video/mp4">
    </video>
    <button class="btn-void">ENTER VOID</button>
</div>

<div id="deck-frame">
    <video autoplay muted loop playsinline class="back-video" preload="none">
        <source src="./bg/Videoleap_2026_01_20_18_07_56_976.mp4" type="video/mp4">
    </video>
    <div id="match-counter">MATCHES: 0/10</div>
</div>

<div id="game-board"></div>

<script>
const faceFiles = [
    "./api/asset/Screenshot_2026-01-20-15-02-24-76.jpg",
    "./api/asset/Screenshot_2026-01-20-15-05-56-58.jpg",
    "./api/asset/Screenshot_2026-01-20-15-06-24-65.jpg",
    "./api/asset/Screenshot_2026-01-20-15-06-39-34.jpg",
    "./api/asset/Screenshot_2026-01-20-15-07-31-75.jpg",
    "./api/asset/Screenshot_2026-01-20-15-09-18-64.jpg",
    "./api/asset/Screenshot_2026-01-20-15-09-46-94.jpg",
    "./api/asset/Screenshot_2026-01-20-15-09-59-72.jpg",
    "./api/asset/Screenshot_2026-01-20-15-10-12-71.jpg",
    "./api/asset/Screenshot_2026-01-20-15-10-25-20.jpg"
];

const cardBackVid = "./bg/Videoleap_2026_01_20_18_07_56_976.mp4";

let flipped = [];
let locked = false;
let matches = 0;

const board = document.getElementById('game-board');
const deckFrame = document.getElementById('deck-frame');
const matchCounter = document.getElementById('match-counter');

document.querySelector('.btn-void').addEventListener('pointerdown', enterVoid);

function enterVoid(e) {
    e.preventDefault();
    const landing = document.getElementById('landing');
    landing.style.opacity = '0';
    setTimeout(() => {
        landing.style.display = 'none';
        board.style.opacity = '1';
        buildBoard();
        setTimeout(ritualDownload, 300);
    }, 800);
}

function buildBoard() {
    board.innerHTML = '';

    let deck = [...faceFiles, ...faceFiles];

    // Fisher-Yates shuffle (unbiased)
    for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
    }

    deck.forEach(img => {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.val = img;

        card.innerHTML = `
            <div class="face front" style="background-image:url('${img}')"></div>
            <div class="face back">
                <video autoplay muted loop playsinline class="back-video" preload="none">
                    <source src="${cardBackVid}" type="video/mp4">
                </video>
            </div>
        `;

        card.addEventListener('pointerdown', (e) => {
            e.preventDefault();
            if (locked || flipped.length >= 2 || card.classList.contains('flipped')) return;

            card.classList.add('flipped');
            flipped.push(card);

            if (flipped.length === 2) {
                locked = true;
                setTimeout(checkMatch, 700);
            }
        });

        board.appendChild(card);
    });
}

function ritualDownload() {
    const deckRect = deckFrame.getBoundingClientRect();
    document.querySelectorAll('.card').forEach(card => {
        const rect = card.getBoundingClientRect();
        const dx = deckRect.left + deckRect.width/2 - (rect.left + rect.width/2);
        const dy = deckRect.top  + deckRect.height/2 - (rect.top  + rect.height/2);
        card.style.transition = 'none';
        card.style.transform = `translate(${dx}px, ${dy}px) scale(0.08)`;
        card.style.opacity = '0';
    });

    setTimeout(deployCards, 100);
}

function deployCards() {
    const cards = document.querySelectorAll('.card');
    cards.forEach((card, i) => {
        setTimeout(() => {
            card.style.transition = 'transform 0.9s cubic-bezier(0.175,0.885,0.32,1.275), opacity 0.6s';
            card.style.transform = 'translate(0,0) scale(1)';
            card.style.opacity = '1';

            // Ensure pointer events are live
            card.style.pointerEvents = 'auto';
        }, i * 50);
    });
}

function checkMatch() {
    const [a, b] = flipped;

    if (a.dataset.val === b.dataset.val) {
        matches++;
        matchCounter.textContent = `MATCHES: ${matches}/10`;

        setTimeout(() => {
            const deckRect = deckFrame.getBoundingClientRect();
            [a, b].forEach(card => {
                const rect = card.getBoundingClientRect();
                const dx = deckRect.left + deckRect.width/2 - (rect.left + rect.width/2);
                const dy = deckRect.top  + deckRect.height/2 - (rect.top  + rect.height/2);
                card.style.transition = 'transform 1s ease-out, opacity 0.9s';
                card.style.transform = `translate(${dx}px, ${dy}px) rotateY(180deg) scale(0.07)`;
                card.style.opacity = '0';
            });
            flipped = [];
            locked = false;
        }, 600);
    } else {
        setTimeout(() => {
            a.classList.remove('flipped');
            b.classList.remove('flipped');
            flipped = [];
            locked = false;
        }, 1100);
    }
}
</script>
</body>
</html>
