<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S T A R B L O O D</title>
    <style>
        :root {
            --blood-dark: #8a0000;
            --blood-glow: #b30000;
            --neon-glow: #ffd700;
            --glass-bg: rgba(20, 0, 0, 0.35);
            --card-w: 85px;
            --card-h: 120px;
        }

        body {
            margin: 0;
            background: #000;
            color: white;
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        #video-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -10;
        }

        .bg-vid {
            width: 100%; height: 100%;
            object-fit: cover;
            opacity: 0.35;
        }

        /* Dripping Header */
        .header {
            margin-top: 15px;
            display: flex;
            gap: 6px;
            z-index: 100;
        }
        .letter {
            font-size: 3.2rem;
            font-weight: 900;
            color: var(--blood-glow);
            text-shadow: 0 0 10px var(--blood-glow), 2px 2px 4px #000;
            display: inline-block;
            animation: bleed 4s infinite ease-in-out;
        }
        @keyframes bleed {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(1.12) translateY(5px); }
        }

        /* Landing Page - Holo Glass Input */
        #landing {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            background: rgba(0,0,0,0.85);
            animation: ripOut 0.8s ease-out;
        }
        @keyframes ripOut {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        #username-input {
            font-size: 1.5rem;
            padding: 12px 24px;
            border: 2px solid var(--blood-dark);
            border-radius: 8px;
            background: var(--glass-bg);
            color: #fff;
            text-align: center;
            box-shadow: inset 0 0 12px var(--blood-glow), 0 0 20px var(--blood-glow), 0 0 40px rgba(139,0,0,0.6);
            backdrop-filter: blur(6px);
            margin-bottom: 20px;
            width: 280px;
        }
        #start-btn {
            padding: 12px 40px;
            background: transparent;
            border: 2px solid var(--blood-glow);
            color: var(--blood-glow);
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 0 25px var(--blood-glow);
            border-radius: 8px;
            backdrop-filter: blur(4px);
        }
        #start-btn:hover {
            background: rgba(139, 0, 0, 0.3);
        }

        /* Game Board */
        #game-board {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 14px;
            width: 90%;
            max-width: 720px;
            margin-top: 20px;
            perspective: 1400px;
        }
        .slot {
            width: var(--card-w);
            height: var(--card-h);
            position: relative;
            border: 1px solid var(--blood-dark);
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(139, 0, 0, 0.4);
            backdrop-filter: blur(2px);
        }

        /* Cards - Dark Blood Holo Glass Frames */
        .card {
            width: 100%;
            height: 100%;
            position: absolute;
            transform-style: preserve-3d;
            transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1), top 0.9s cubic-bezier(0.5, 0, 0.5, 1), left 0.9s cubic-bezier(0.5, 0, 0.5, 1), opacity 0.6s;
            cursor: pointer;
            z-index: 10;
        }
        .card.flipped { transform: rotateY(180deg); }
        .card.returning {
            z-index: 1000;
            pointer-events: none;
            transition: all 1.1s cubic-bezier(0.6, -0.28, 0.735, 0.045);
        }

        .face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 10px;
            border: 2px solid var(--blood-dark);
            background-size: cover;
            background-position: center;
            box-shadow: inset 0 0 15px var(--blood-glow), 0 0 20px var(--blood-glow), 0 0 35px rgba(139,0,0,0.7);
            backdrop-filter: blur(3px);
        }
        .front { transform: rotateY(180deg); }
        .back {
            background-image: url('https://j3oblrqjmsss4ayx.public.blob.vercel-storage.com/Star%20Blood%20Card%20Deck%20Face%20Value/1768948913173.jpg');
        }

        .matched-glow {
            box-shadow: inset 0 0 25px var(--blood-glow), 0 0 40px var(--blood-glow), 0 0 60px rgba(139,0,0,0.9) !important;
            transition: box-shadow 0.5s;
        }

        /* Deck Stack - Holo Frame */
        .deck-stack {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 90px;
            height: 125px;
            cursor: pointer;
            z-index: 200;
            border-radius: 12px;
            border: 2px solid var(--blood-dark);
            box-shadow: 0 0 25px var(--blood-glow), inset 0 0 15px var(--blood-glow);
            backdrop-filter: blur(4px);
        }
        .deck-art {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 10px;
            background-size: cover;
            background-image: url('https://j3oblrqjmsss4ayx.public.blob.vercel-storage.com/Star%20Blood%20Card%20Deck%20Face%20Value/1768948913173.jpg');
        }
        .deck-label {
            position: absolute;
            bottom: -24px;
            width: 100%;
            text-align: center;
            font-size: 11px;
            color: var(--blood-glow);
            text-shadow: 0 0 8px var(--blood-glow);
        }

        /* Timer */
        #timer {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 1.5rem;
            color: var(--blood-glow);
            text-shadow: 0 0 10px var(--blood-glow);
            z-index: 100;
        }

        /* End Overlay - Holo Glass */
        #end-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.92);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 300;
        }
        #congrats-message {
            font-size: 3rem;
            color: var(--blood-glow);
            text-shadow: 0 0 20px var(--blood-glow);
            padding: 20px 40px;
            border: 3px solid var(--blood-dark);
            border-radius: 12px;
            box-shadow: 0 0 40px var(--blood-glow), inset 0 0 25px var(--blood-glow);
            backdrop-filter: blur(8px);
            animation: bounceBlood 2s infinite;
        }
        @keyframes bounceBlood {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-12px); }
        }

        /* Leaderboard - Neon Holo Glass Grid */
        #leaderboard {
            margin-top: 40px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 25px;
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 3px solid var(--blood-dark);
            border-radius: 12px;
            box-shadow: 0 0 35px var(--blood-glow), inset 0 0 20px var(--blood-glow);
            max-width: 700px;
        }
        .lb-header .lb-cell {
            font-weight: bold;
            color: var(--neon-glow);
            text-shadow: 0 0 8px var(--neon-glow);
        }
        .lb-cell {
            padding: 8px;
            text-align: center;
            border: 1px solid rgba(139, 0, 0, 0.4);
            border-radius: 6px;
        }

        /* Blood Rain Drops */
        .rain-drop {
            position: absolute;
            width: 4px;
            height: 25px;
            background: linear-gradient(to bottom, var(--blood-glow), var(--blood-dark));
            opacity: 0.9;
            border-radius: 50% 50% 0 0;
            box-shadow: 0 0 12px var(--blood-glow);
            animation: fall linear infinite;
        }
        @keyframes fall {
            0% { transform: translateY(-120%); }
            100% { transform: translateY(120vh); }
        }

        /* Surprise Push Effect */
        #push-overlay {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 250;
            opacity: 0;
            transition: opacity 1s ease;
        }

        .push-active #video-container {
            filter: url(#push-distort-strong);
            transition: filter 0.4s ease-in;
        }

        #entity-flash {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 260;
            opacity: 0;
            transition: opacity 0.4s ease-in-out;
            background: radial-gradient(circle at 50% 50%, rgba(255,0,0,0.4) 0%, transparent 70%);
            mix-blend-mode: screen;
        }

        #entity-flash > div {
            position: absolute;
            top: 50%; left: 50%;
            width: 320px; height: 420px;
            transform: translate(-50%, -50%) scale(0.85);
            background: radial-gradient(ellipse at 50% 40%, #fff 0%, #000 35%, transparent 65%);
            filter: invert(1) hue-rotate(170deg) brightness(1.3);
            opacity: 0.75;
            border-radius: 50%;
            box-shadow: 0 0 100px #b30000;
        }
    </style>
</head>
<body>

    <div id="video-container">
        <video autoplay muted loop playsinline class="bg-vid">
            <source src="https://j3oblrqjmsss4ayx.public.blob.vercel-storage.com/2026-01-20-125904299.mp4" type="video/mp4">
        </video>
    </div>

    <!-- Surprise Entity Flash -->
    <div id="entity-flash">
        <div></div>
    </div>

    <div id="landing">
        <input id="username-input" type="text" placeholder="Enter Username" maxlength="20">
        <button id="start-btn">Enter the Void</button>
    </div>

    <div class="header" id="title"></div>

    <div id="timer">00:00</div>

    <div id="game-board"></div>

    <div class="deck-stack" id="deck">
        <div class="deck-art" style="transform: translate(-5px, -5px); opacity: 0.6;"></div>
        <div class="deck-art"></div>
        <div class="deck-label">TAP TO SHUFFLE</div>
    </div>

    <div id="end-overlay">
        <div id="congrats-message">Starblood Awakens! Victory in the Cosmos!</div>
        <div id="leaderboard"></div>
    </div>

    <!-- SVG Filters -->
    <svg width="0" height="0" style="position:absolute;">
        <defs>
            <filter id="push-distort-strong" x="-50%" y="-50%" width="200%" height="200%">
                <feTurbulence type="fractalNoise" baseFrequency="0.005 0.01" numOctaves="5" seed="42" result="noise"/>
                <feDisplacementMap in="SourceGraphic" in2="noise" scale="0" xChannelSelector="R" yChannelSelector="G"/>
                <feComponentTransfer>
                    <feFuncR type="linear" slope="1.5"/>
                    <feFuncG type="linear" slope="1.5"/>
                    <feFuncB type="linear" slope="1.5"/>
                </feComponentTransfer>
            </filter>
        </defs>
    </svg>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

    <script>
        // Replace with your actual Firebase config
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Title animation
        const header = document.getElementById('title');
        "STARBLOOD".split('').forEach((l, i) => {
            const span = document.createElement('span');
            span.className = 'letter';
            span.textContent = l;
            span.style.animationDelay = `${i * 0.08}s`;
            header.appendChild(span);
        });

        // Game variables and logic (assets, initGame, flipCard, checkMatch, updateTimer, createBloodRain) remain the same as in your previous version

        // ... paste your existing game script logic here (assets, initGame, flipCard, checkMatch, etc.) ...

        async function endGame() {
            clearInterval(timerInterval);
            const time = Math.floor((Date.now() - startTime) / 1000);
            const date = new Date().toLocaleDateString();

            await db.collection('scores').add({
                username,
                time,
                date,
                timestamp: firebase.firestore.Timestamp.now()
            });

            // Surprise only once per session
            if (localStorage.getItem('starblood_entity_seen') === 'true') {
                endOverlay.style.display = 'flex';
                createBloodRain();
                // load leaderboard here
                return;
            }
            localStorage.setItem('starblood_entity_seen', 'true');

            // Surprise delay 2â€“5 seconds
            const surpriseDelay = Math.random() * 3000 + 2000;

            setTimeout(() => {
                const overlay = document.createElement('div');
                overlay.id = 'push-overlay';
                overlay.style.opacity = '1';
                document.body.appendChild(overlay);

                document.body.classList.add('push-active');

                const entityFlash = document.getElementById('entity-flash');
                entityFlash.style.opacity = '1';

                // Sudden max distortion
                const displace = document.querySelector('#push-distort-strong feDisplacementMap');
                displace.setAttribute('scale', '180');

                // Brief intense flash of entity
                setTimeout(() => {
                    entityFlash.style.opacity = '0.95';
                    setTimeout(() => {
                        entityFlash.style.opacity = '0';
                    }, 350);
                }, 250);

                // Settle after short hold
                setTimeout(() => {
                    let scale = 180;
                    const settleInterval = setInterval(() => {
                        scale -= 18;
                        displace.setAttribute('scale', Math.max(0, scale));
                        if (scale <= 0) {
                            clearInterval(settleInterval);
                            document.body.classList.remove('push-active');
                            overlay.style.opacity = '0';
                            setTimeout(() => {
                                overlay.remove();
                                endOverlay.style.display = 'flex';
                                createBloodRain();
                                // load leaderboard here
                            }, 1200);
                        }
                    }, 70);
                }, 900); // brief peak hold
            }, surpriseDelay);
        }

        // Add your remaining functions: initGame, flipCard, checkMatch, updateTimer, createBloodRain, landing button listener, etc.
        // For example:
        document.getElementById('start-btn').addEventListener('click', () => {
            username = document.getElementById('username-input').value.trim();
            if (username) {
                landing.style.display = 'none';
                // enable deck onclick = initGame etc.
            }
        });

        // ... rest of your script ...
    </script>
</body>
</html>
